"use strict";(self.webpackChunknestjs_rpc_docs=self.webpackChunknestjs_rpc_docs||[]).push([[490],{8453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>c});var n=t(6540);const s={},i=n.createContext(s);function o(e){const r=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),n.createElement(i.Provider,{value:r},e.children)}},8780:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"server/nest-integration","title":"Nest Integration","description":"Initialize NestJS RPC before app creation and define the manifest. Critical setup steps for proper integration.","source":"@site/docs/server/nest-integration.md","sourceDirName":"server","slug":"/server/nest-integration","permalink":"/NestRPC-docs/docs/server/nest-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/Natansal/NestRPC-docs/blob/main/docs/server/nest-integration.md","tags":[],"version":"current","frontMatter":{"title":"Nest Integration","description":"Initialize NestJS RPC before app creation and define the manifest. Critical setup steps for proper integration."},"sidebar":"tutorialSidebar","previous":{"title":"Execution Context","permalink":"/NestRPC-docs/docs/server/execution-context"},"next":{"title":"Server Error Handling","permalink":"/NestRPC-docs/docs/server/error-handling"}}');var s=t(4848),i=t(8453);const o={title:"Nest Integration",description:"Initialize NestJS RPC before app creation and define the manifest. Critical setup steps for proper integration."},c="Nest Integration",l={},a=[{value:"\u26a0\ufe0f Critical: Initialize Before App Creation",id:"\ufe0f-critical-initialize-before-app-creation",level:2},{value:"Why This Order Matters",id:"why-this-order-matters",level:3},{value:"\ud83d\udccb Define the Manifest",id:"-define-the-manifest",level:2},{value:"Manifest Structure",id:"manifest-structure",level:3},{value:"\ud83d\udce6 Register Routers in Module",id:"-register-routers-in-module",level:2},{value:"\ud83d\udd27 Configuration Options",id:"-configuration-options",level:2},{value:"API Prefix",id:"api-prefix",level:3},{value:"\u2705 Complete Setup Example",id:"-complete-setup-example",level:2},{value:"\ud83d\udc1b Troubleshooting",id:"-troubleshooting",level:2},{value:"Routes Not Registered",id:"routes-not-registered",level:3},{value:"Type Errors",id:"type-errors",level:3},{value:"\ud83d\udcda Further Reading",id:"-further-reading",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"nest-integration",children:"Nest Integration"})}),"\n",(0,s.jsxs)(r.p,{children:["Proper integration with NestJS requires calling ",(0,s.jsx)(r.code,{children:"nestRpcInit()"})," before app creation and properly defining your manifest. This guide covers the essential setup steps."]}),"\n",(0,s.jsx)(r.h2,{id:"\ufe0f-critical-initialize-before-app-creation",children:"\u26a0\ufe0f Critical: Initialize Before App Creation"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsxs)(r.strong,{children:[(0,s.jsx)(r.code,{children:"nestRpcInit()"})," MUST be called BEFORE ",(0,s.jsx)(r.code,{children:"NestFactory.create()"})]}),". This is essential because NestRPC applies NestJS decorators (",(0,s.jsx)(r.code,{children:"@Controller()"}),", ",(0,s.jsx)(r.code,{children:"@Post()"}),", etc.) to your router classes, and NestJS needs these decorators to be present when it discovers controllers during app creation."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"// main.ts\nimport { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { nestRpcInit } from '@nestjs-rpc/server';\nimport { manifest } from './nest-rpc.config';\n\nasync function bootstrap() {\n  // \u2705 Must be called BEFORE app creation\n  // This applies decorators that Nest needs at bootstrap\n  nestRpcInit(manifest, { apiPrefix: 'nestjs-rpc' }); // 'nestjs-rpc' is default\n\n  // Then create your Nest app\n  const app = await NestFactory.create(AppModule);\n  \n  // Enable CORS if needed for your client\n  app.enableCors({\n    origin: 'http://localhost:5173',\n    credentials: true,\n  });\n  \n  await app.listen(3000);\n  console.log('\ud83d\ude80 Server running on http://localhost:3000');\n}\n\nbootstrap();\n"})}),"\n",(0,s.jsx)(r.h3,{id:"why-this-order-matters",children:"Why This Order Matters"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"nestRpcInit()"})," applies decorators to your router classes"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"NestFactory.create()"})," discovers controllers by scanning for ",(0,s.jsx)(r.code,{children:"@Controller()"})," decorators"]}),"\n",(0,s.jsxs)(r.li,{children:["If ",(0,s.jsx)(r.code,{children:"nestRpcInit()"})," is called after ",(0,s.jsx)(r.code,{children:"NestFactory.create()"}),", the decorators won't be applied in time"]}),"\n",(0,s.jsx)(r.li,{children:"Your routes won't be registered"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"-define-the-manifest",children:"\ud83d\udccb Define the Manifest"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"defineManifest()"})," creates a manifest from your router structure and preserves type information so the client can infer method signatures and inputs."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"// nest-rpc.config.ts\nimport { defineManifest } from '@nestjs-rpc/server';\nimport { UserQueriesRouter } from './user/user.queries.router';\nimport { UserMutationsRouter } from './user/user.mutations.router';\nimport { FilesRouter } from './files/files.router';\n\nexport const manifest = defineManifest({\n  user: {\n    queries: UserQueriesRouter,\n    mutations: UserMutationsRouter,\n  },\n  files: FilesRouter,\n});\n\n// \ud83d\udd01 Always export the type for client-side type safety\nexport type Manifest = typeof manifest;\n"})}),"\n",(0,s.jsx)(r.h3,{id:"manifest-structure",children:"Manifest Structure"}),"\n",(0,s.jsx)(r.p,{children:"The manifest structure defines your API organization:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"export const manifest = defineManifest({\n  // Flat structure\n  user: UserRouter,\n  files: FilesRouter,\n  \n  // Nested structure\n  admin: {\n    users: AdminUsersRouter,\n    settings: AdminSettingsRouter,\n  },\n});\n"})}),"\n",(0,s.jsx)(r.p,{children:"The keys you choose become the paths on the client:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"rpc.user.someMethod()"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"rpc.files.uploadFile()"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"rpc.admin.users.listAll()"})}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"-register-routers-in-module",children:"\ud83d\udce6 Register Routers in Module"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"\u26a0\ufe0f CRITICAL:"})," Routers are NestJS controllers under the hood. Router classes ",(0,s.jsx)(r.strong,{children:"MUST"})," be registered in your NestJS module's ",(0,s.jsx)(r.code,{children:"controllers"})," array for them to work:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"// app.module.ts\nimport { Module } from '@nestjs/common';\nimport { UserQueriesRouter } from './user/user.queries.router';\nimport { UserMutationsRouter } from './user/user.mutations.router';\nimport { FilesRouter } from './files/files.router';\n\n@Module({\n  controllers: [\n    UserQueriesRouter,\n    UserMutationsRouter,\n    FilesRouter,\n  ],\n  providers: [],\n})\nexport class AppModule {}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-configuration-options",children:"\ud83d\udd27 Configuration Options"}),"\n",(0,s.jsx)(r.h3,{id:"api-prefix",children:"API Prefix"}),"\n",(0,s.jsx)(r.p,{children:"Set a custom API prefix:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"nestRpcInit(manifest, { apiPrefix: 'api/v1' });\n"})}),"\n",(0,s.jsx)(r.p,{children:"All routes will be prefixed with this path:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"POST /api/v1/user/getUserById"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.code,{children:"POST /api/v1/files/uploadFile"})}),"\n"]}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"Default:"})," ",(0,s.jsx)(r.code,{children:"'nestjs-rpc'"})]}),"\n",(0,s.jsx)(r.h2,{id:"-complete-setup-example",children:"\u2705 Complete Setup Example"}),"\n",(0,s.jsx)(r.p,{children:"Here's a complete setup example:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"// nest-rpc.config.ts\nimport { defineManifest } from '@nestjs-rpc/server';\nimport { UserQueriesRouter } from './user/user.queries.router';\nimport { UserMutationsRouter } from './user/user.mutations.router';\n\nexport const manifest = defineManifest({\n  user: {\n    queries: UserQueriesRouter,\n    mutations: UserMutationsRouter,\n  },\n});\n\nexport type Manifest = typeof manifest;\n\n// app.module.ts\nimport { Module } from '@nestjs/common';\nimport { UserQueriesRouter } from './user/user.queries.router';\nimport { UserMutationsRouter } from './user/user.mutations.router';\n\n@Module({\n  controllers: [UserQueriesRouter, UserMutationsRouter],\n  providers: [],\n})\nexport class AppModule {}\n\n// main.ts\nimport { NestFactory } from '@nestjs/core';\nimport { AppModule } from './app.module';\nimport { nestRpcInit } from '@nestjs-rpc/server';\nimport { manifest } from './nest-rpc.config';\n\nasync function bootstrap() {\n  // \u2705 Step 1: Initialize RPC (MUST be first)\n  nestRpcInit(manifest, { apiPrefix: 'nestjs-rpc' });\n\n  // \u2705 Step 2: Create Nest app\n  const app = await NestFactory.create(AppModule);\n\n  // \u2705 Step 3: Configure app (CORS, etc.)\n  app.enableCors({\n    origin: 'http://localhost:5173',\n    credentials: true,\n  });\n\n  // \u2705 Step 4: Start server\n  await app.listen(3000);\n  console.log('\ud83d\ude80 Server running on http://localhost:3000');\n}\n\nbootstrap();\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-troubleshooting",children:"\ud83d\udc1b Troubleshooting"}),"\n",(0,s.jsx)(r.h3,{id:"routes-not-registered",children:"Routes Not Registered"}),"\n",(0,s.jsx)(r.p,{children:"If your routes aren't being registered:"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\u2705 Check that ",(0,s.jsx)(r.code,{children:"nestRpcInit()"})," is called ",(0,s.jsx)(r.strong,{children:"before"})," ",(0,s.jsx)(r.code,{children:"NestFactory.create()"})]}),"\n",(0,s.jsxs)(r.li,{children:["\u2705 Check that router classes are in the module's ",(0,s.jsx)(r.code,{children:"controllers"})," array"]}),"\n",(0,s.jsxs)(r.li,{children:["\u2705 Check that classes have ",(0,s.jsx)(r.code,{children:"@Router()"})," decorator"]}),"\n",(0,s.jsxs)(r.li,{children:["\u2705 Check that methods have ",(0,s.jsx)(r.code,{children:"@Route()"})," decorator"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"type-errors",children:"Type Errors"}),"\n",(0,s.jsx)(r.p,{children:"If you're getting type errors:"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\u2705 Make sure you export ",(0,s.jsx)(r.code,{children:"export type Manifest = typeof manifest"})]}),"\n",(0,s.jsxs)(r.li,{children:["\u2705 Make sure the client imports the correct ",(0,s.jsx)(r.code,{children:"Manifest"})," type"]}),"\n",(0,s.jsx)(r.li,{children:"\u2705 Check that TypeScript can resolve the type (may need path mapping)"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"-further-reading",children:"\ud83d\udcda Further Reading"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/docs/quick-start",children:"Quick Start"})," - Get started quickly"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/docs/server/routers-and-routes",children:"Routers and Routes"})," - Define routes"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"/docs/server/execution-context",children:"Execution Context"})," - How routes execute"]}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);