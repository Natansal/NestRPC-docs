"use strict";(self.webpackChunknestjs_rpc_docs=self.webpackChunknestjs_rpc_docs||[]).push([[352],{1774:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"server/error-handling","title":"Server Error Handling","description":"How errors are surfaced to the client. Using NestJS exceptions, custom exception filters, and proper error responses.","source":"@site/docs/server/error-handling.md","sourceDirName":"server","slug":"/server/error-handling","permalink":"/NestRPC-docs/docs/server/error-handling","draft":false,"unlisted":false,"editUrl":"https://github.com/Natansal/NestRPC-docs/blob/main/docs/server/error-handling.md","tags":[],"version":"current","frontMatter":{"title":"Server Error Handling","description":"How errors are surfaced to the client. Using NestJS exceptions, custom exception filters, and proper error responses."},"sidebar":"tutorialSidebar","previous":{"title":"Nest Integration","permalink":"/NestRPC-docs/docs/server/nest-integration"},"next":{"title":"Client Overview","permalink":"/NestRPC-docs/docs/client/overview"}}');var s=r(4848),i=r(8453);const o={title:"Server Error Handling",description:"How errors are surfaced to the client. Using NestJS exceptions, custom exception filters, and proper error responses."},c="Server Error Handling",l={},d=[{value:"\ud83c\udfaf Basic Error Handling",id:"-basic-error-handling",level:2},{value:"\ud83d\udccb Common Exceptions",id:"-common-exceptions",level:2},{value:"\ud83c\udfa8 Custom Error Messages",id:"-custom-error-messages",level:2},{value:"\ud83d\udd12 Authentication &amp; Authorization Errors",id:"-authentication--authorization-errors",level:2},{value:"\ud83c\udfaf Custom Exception Filters",id:"-custom-exception-filters",level:2},{value:"\ud83d\udce4 File Upload Errors",id:"-file-upload-errors",level:2},{value:"\ud83d\udd04 Error Propagation",id:"-error-propagation",level:2},{value:"\ud83d\udcda Further Reading",id:"-further-reading",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"server-error-handling",children:"Server Error Handling"})}),"\n",(0,s.jsx)(n.p,{children:"Throw inside a route method to trigger Nest's standard exception handling. The client receives the HTTP error mapped by Nest (e.g., 400/401/500) via Axios."}),"\n",(0,s.jsx)(n.h2,{id:"-basic-error-handling",children:"\ud83c\udfaf Basic Error Handling"}),"\n",(0,s.jsx)(n.p,{children:"Use NestJS built-in exceptions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\nimport { \n  BadRequestException, \n  NotFoundException,\n  UnauthorizedException,\n  ForbiddenException,\n  InternalServerErrorException,\n} from '@nestjs/common';\n\n@Router()\nexport class UserMutationsRouter {\n  @Route()\n  updateUser({ id, name }: { id: string; name: string }) {\n    // \u2705 Validate input\n    if (!id) {\n      throw new BadRequestException('id is required');\n    }\n    \n    // \u2705 Check existence\n    const user = findUser(id);\n    if (!user) {\n      throw new NotFoundException(`User with ID ${id} not found`);\n    }\n    \n    // \u2705 Business logic validation\n    if (name.length < 2) {\n      throw new BadRequestException('Name must be at least 2 characters');\n    }\n    \n    return saveUser({ ...user, name });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-common-exceptions",children:"\ud83d\udccb Common Exceptions"}),"\n",(0,s.jsx)(n.p,{children:"NestJS provides many built-in exceptions:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Exception"}),(0,s.jsx)(n.th,{children:"HTTP Status"}),(0,s.jsx)(n.th,{children:"Use Case"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BadRequestException"})}),(0,s.jsx)(n.td,{children:"400"}),(0,s.jsx)(n.td,{children:"Invalid input, validation errors"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"UnauthorizedException"})}),(0,s.jsx)(n.td,{children:"401"}),(0,s.jsx)(n.td,{children:"Authentication required"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ForbiddenException"})}),(0,s.jsx)(n.td,{children:"403"}),(0,s.jsx)(n.td,{children:"Insufficient permissions"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"NotFoundException"})}),(0,s.jsx)(n.td,{children:"404"}),(0,s.jsx)(n.td,{children:"Resource not found"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ConflictException"})}),(0,s.jsx)(n.td,{children:"409"}),(0,s.jsx)(n.td,{children:"Resource conflict (e.g., duplicate)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"InternalServerErrorException"})}),(0,s.jsx)(n.td,{children:"500"}),(0,s.jsx)(n.td,{children:"Server errors"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HttpException"})}),(0,s.jsx)(n.td,{children:"Custom"}),(0,s.jsx)(n.td,{children:"Custom status codes"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"-custom-error-messages",children:"\ud83c\udfa8 Custom Error Messages"}),"\n",(0,s.jsx)(n.p,{children:"Provide detailed error messages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Route()\nasync createUser({ name, email }: { name: string; email: string }) {\n  // \u2705 Detailed validation\n  if (!name || name.trim().length === 0) {\n    throw new BadRequestException('Name is required and cannot be empty');\n  }\n  \n  if (!isValidEmail(email)) {\n    throw new BadRequestException(`Invalid email format: ${email}`);\n  }\n  \n  // \u2705 Check for duplicates\n  const existing = await this.userService.findByEmail(email);\n  if (existing) {\n    throw new ConflictException(`User with email ${email} already exists`);\n  }\n  \n  return this.userService.create({ name, email });\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-authentication--authorization-errors",children:"\ud83d\udd12 Authentication & Authorization Errors"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Router()\nexport class UserRouter {\n  @Route()\n  async getProfile(\n    {},\n    @CurrentUser() user: User | null,\n  ) {\n    // \u2705 Check authentication\n    if (!user) {\n      throw new UnauthorizedException('Authentication required');\n    }\n    \n    return user;\n  }\n  \n  @Route()\n  async deleteUser(\n    { id }: { id: string },\n    @CurrentUser() user: User,\n  ) {\n    // \u2705 Check authorization\n    if (user.id !== id && !user.isAdmin) {\n      throw new ForbiddenException('You do not have permission to delete this user');\n    }\n    \n    return this.userService.delete(id);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-custom-exception-filters",children:"\ud83c\udfaf Custom Exception Filters"}),"\n",(0,s.jsx)(n.p,{children:"Create custom exception filters for consistent error responses:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { ExceptionFilter, Catch, ArgumentsHost, HttpException } from '@nestjs/common';\nimport { Request, Response } from 'express';\n\n@Catch()\nexport class AllExceptionsFilter implements ExceptionFilter {\n  catch(exception: unknown, host: ArgumentsHost) {\n    const ctx = host.switchToHttp();\n    const response = ctx.getResponse<Response>();\n    const request = ctx.getRequest<Request>();\n\n    let status = 500;\n    let message = 'Internal server error';\n\n    if (exception instanceof HttpException) {\n      status = exception.getStatus();\n      const exceptionResponse = exception.getResponse();\n      message = typeof exceptionResponse === 'string' \n        ? exceptionResponse \n        : (exceptionResponse as any).message || message;\n    }\n\n    response.status(status).json({\n      statusCode: status,\n      timestamp: new Date().toISOString(),\n      path: request.url,\n      message,\n    });\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Apply globally:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// main.ts\napp.useGlobalFilters(new AllExceptionsFilter());\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-file-upload-errors",children:"\ud83d\udce4 File Upload Errors"}),"\n",(0,s.jsx)(n.p,{children:"Handle file upload errors specifically:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Route({ file: 'single' })\nasync uploadFile(\n  { description }: { description?: string },\n  file?: Express.Multer.File\n) {\n  // \u2705 Check file presence\n  if (!file) {\n    throw new BadRequestException('No file provided');\n  }\n\n  // \u2705 Validate file size\n  const maxSize = 5 * 1024 * 1024; // 5MB\n  if (file.size > maxSize) {\n    throw new BadRequestException(`File size exceeds ${maxSize / 1024 / 1024}MB limit`);\n  }\n\n  // \u2705 Validate file type\n  const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];\n  if (!allowedTypes.includes(file.mimetype)) {\n    throw new BadRequestException(\n      `Invalid file type. Allowed types: ${allowedTypes.join(', ')}`\n    );\n  }\n\n  // Process file...\n  return { success: true, filename: file.originalname };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-error-propagation",children:"\ud83d\udd04 Error Propagation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note:"})," Each call executes independently; one failing call does not affect others. Errors are automatically converted to HTTP responses:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Server throws\nthrow new NotFoundException('User not found');\n\n// Client receives\n// Status: 404\n// Body: { statusCode: 404, message: 'User not found' }\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-further-reading",children:"\ud83d\udcda Further Reading"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.nestjs.com/exception-filters",children:"NestJS Exception Filters"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.nestjs.com/guards",children:"NestJS Guards"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/client/error-handling",children:"Client Error Handling"})," - How errors appear on the client"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>c});var t=r(6540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);