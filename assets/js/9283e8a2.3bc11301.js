"use strict";(self.webpackChunknestjs_rpc_docs=self.webpackChunknestjs_rpc_docs||[]).push([[731],{7224:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"server/routers-and-routes","title":"Routers and Routes","description":"Define routers with @Router and RPC endpoints with @Route. Learn about file uploads, nested routers, and parameter decorators.","source":"@site/docs/server/routers-and-routes.md","sourceDirName":"server","slug":"/server/routers-and-routes","permalink":"/NestRPC-docs/docs/server/routers-and-routes","draft":false,"unlisted":false,"editUrl":"https://github.com/Natansal/NestRPC-docs/blob/main/docs/server/routers-and-routes.md","tags":[],"version":"current","frontMatter":{"title":"Routers and Routes","description":"Define routers with @Router and RPC endpoints with @Route. Learn about file uploads, nested routers, and parameter decorators."},"sidebar":"tutorialSidebar","previous":{"title":"Server Overview","permalink":"/NestRPC-docs/docs/server/overview"},"next":{"title":"File Uploads","permalink":"/NestRPC-docs/docs/server/file-uploads"}}');var t=n(4848),i=n(8453);const o={title:"Routers and Routes",description:"Define routers with @Router and RPC endpoints with @Route. Learn about file uploads, nested routers, and parameter decorators."},a="Routers and Routes",l={},d=[{value:"\ud83c\udfaf Defining a Router",id:"-defining-a-router",level:2},{value:"\ud83d\udee3\ufe0f Defining Routes",id:"\ufe0f-defining-routes",level:2},{value:"\ud83d\udce4 File Upload Routes",id:"-file-upload-routes",level:3},{value:"\ud83d\udccb Registering Routers",id:"-registering-routers",level:2},{value:"Create the Manifest",id:"create-the-manifest",level:3},{value:"Register in Module",id:"register-in-module",level:3},{value:"Initialize Before App Creation",id:"initialize-before-app-creation",level:3},{value:"\ud83d\udce5 Parameter Rules",id:"-parameter-rules",level:2},{value:"\ud83c\udfa8 Nested Routers",id:"-nested-routers",level:2},{value:"Client Pathing",id:"client-pathing",level:3},{value:"\ud83d\udd27 Advanced Usage",id:"-advanced-usage",level:2},{value:"Dependency Injection",id:"dependency-injection",level:3},{value:"Custom Parameter Decorators",id:"custom-parameter-decorators",level:3},{value:"Custom Router Parameter Decorators",id:"custom-router-parameter-decorators",level:3},{value:"\ud83d\udcda Further Reading",id:"-further-reading",level:2}];function c(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"routers-and-routes",children:"Routers and Routes"})}),"\n",(0,t.jsx)(r.p,{children:"Routers and routes are the core building blocks of NestRPC. This guide covers everything you need to know about defining and organizing your RPC endpoints."}),"\n",(0,t.jsx)(r.h2,{id:"-defining-a-router",children:"\ud83c\udfaf Defining a Router"}),"\n",(0,t.jsxs)(r.p,{children:["Create a router class with the ",(0,t.jsx)(r.code,{children:"@Router()"})," decorator:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\n\n@Router()\nexport class UserQueriesRouter {\n  @Route()\n  getUser({ id }: { id: string }) {\n    return { id, name: 'John Doe', email: 'john@example.com' };\n  }\n\n  @Route()\n  listUsers() {\n    return [\n      { id: '1', name: 'Alice' },\n      { id: '2', name: 'Bob' },\n    ];\n  }\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.code,{children:"@Router()"})," decorator applies ",(0,t.jsx)(r.code,{children:"@Controller()"})," under the hood, making your class a NestJS controller. This means:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Routers accept all NestJS controller parameter decorators (",(0,t.jsx)(r.code,{children:"@Req()"}),", ",(0,t.jsx)(r.code,{children:"@Res()"}),", ",(0,t.jsx)(r.code,{children:"@Headers()"}),", ",(0,t.jsx)(r.code,{children:"@Body()"}),", etc.)"]}),"\n",(0,t.jsxs)(r.li,{children:["Routes can have guard and pipe decorators (",(0,t.jsx)(r.code,{children:"@UseGuards()"}),", ",(0,t.jsx)(r.code,{children:"@UsePipes()"}),", ",(0,t.jsx)(r.code,{children:"@UseInterceptors()"}),", etc.) just like native NestJS controllers"]}),"\n",(0,t.jsx)(r.li,{children:"They work with dependency injection, interceptors, and all NestJS features"}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsxs)(r.strong,{children:["They MUST be registered in the module's ",(0,t.jsx)(r.code,{children:"controllers"})," array"]})}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"\ufe0f-defining-routes",children:"\ud83d\udee3\ufe0f Defining Routes"}),"\n",(0,t.jsxs)(r.p,{children:["Mark methods with ",(0,t.jsx)(r.code,{children:"@Route()"})," to expose them as RPC endpoints:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"@Router()\nexport class UserMutationsRouter {\n  @Route()\n  createUser({ name, email }: { name: string; email: string }) {\n    // Create user logic\n    return { id: '123', name, email };\n  }\n\n  @Route()\n  updateUser({ id, name, email }: { id: string; name?: string; email?: string }) {\n    // Update user logic\n    return { id, name, email };\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"-file-upload-routes",children:"\ud83d\udce4 File Upload Routes"}),"\n",(0,t.jsxs)(r.p,{children:["NestRPC has built-in support for file uploads. See the ",(0,t.jsx)(r.a,{href:"/docs/server/file-uploads",children:"File Uploads"})," guide for details:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"@Router()\nexport class FilesRouter {\n  // Single file upload\n  @Route({ file: 'single' })\n  uploadFile(\n    { description }: { description?: string },\n    file?: Express.Multer.File\n  ) {\n    return { filename: file?.originalname, size: file?.size };\n  }\n\n  // Multiple file upload\n  @Route({ file: 'multiple' })\n  uploadFiles(\n    { category }: { category?: string },\n    files?: Express.Multer.File[]\n  ) {\n    return { files: files?.map(f => f.originalname), count: files?.length };\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"-registering-routers",children:"\ud83d\udccb Registering Routers"}),"\n",(0,t.jsx)(r.h3,{id:"create-the-manifest",children:"Create the Manifest"}),"\n",(0,t.jsxs)(r.p,{children:["Use ",(0,t.jsx)(r.code,{children:"defineManifest()"})," to map keys to routers or nested maps:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"import { defineManifest } from '@nestjs-rpc/server';\nimport { UserQueriesRouter } from './user.queries.router';\nimport { UserMutationsRouter } from './user.mutations.router';\n\nexport const manifest = defineManifest({\n  user: {\n    queries: UserQueriesRouter,\n    mutations: UserMutationsRouter,\n  },\n});\n\n// \ud83d\udd01 Export the type for client-side type safety\nexport type Manifest = typeof manifest;\n"})}),"\n",(0,t.jsx)(r.h3,{id:"register-in-module",children:"Register in Module"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"\u26a0\ufe0f CRITICAL:"})," Routers are NestJS controllers under the hood. You ",(0,t.jsx)(r.strong,{children:"MUST"})," add your router classes to the module's ",(0,t.jsx)(r.code,{children:"controllers"})," array so Nest can instantiate them:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { UserQueriesRouter } from './user.queries.router';\nimport { UserMutationsRouter } from './user.mutations.router';\n\n@Module({\n  controllers: [UserQueriesRouter, UserMutationsRouter],\n  providers: [],\n})\nexport class AppModule {}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"initialize-before-app-creation",children:"Initialize Before App Creation"}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"\u26a0\ufe0f CRITICAL:"})," Call ",(0,t.jsx)(r.code,{children:"nestRpcInit(manifest)"})," ",(0,t.jsx)(r.strong,{children:"BEFORE"})," creating your Nest app:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"import { nestRpcInit } from '@nestjs-rpc/server';\n\nasync function bootstrap() {\n  nestRpcInit(manifest); // \u2705 Must be called FIRST\n  \n  const app = await NestFactory.create(AppModule);\n  await app.listen(3000);\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"The runtime validates that:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["The final path segment is a router class decorated with ",(0,t.jsx)(r.code,{children:"@Router()"})]}),"\n",(0,t.jsxs)(r.li,{children:["The method exists and is decorated with ",(0,t.jsx)(r.code,{children:"@Route()"})]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"-parameter-rules",children:"\ud83d\udce5 Parameter Rules"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Important parameter rules:"})}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"First Parameter (index 0)"}),": Reserved for the ",(0,t.jsx)(r.strong,{children:"incoming request body"}),". It's automatically injected. ",(0,t.jsx)(r.strong,{children:"Do not decorate it."})," Its TypeScript type flows to the client automatically."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Second Parameter (index 1)"}),": If the route has file upload configuration (",(0,t.jsx)(r.code,{children:"file: 'single'"})," or ",(0,t.jsx)(r.code,{children:"file: 'multiple'"}),"), this parameter is ",(0,t.jsx)(r.strong,{children:"reserved for the file/files"})," (",(0,t.jsx)(r.code,{children:"Express.Multer.File"})," or ",(0,t.jsx)(r.code,{children:"Express.Multer.File[]"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Subsequent Parameters"}),": Can use NestJS parameter decorators (",(0,t.jsx)(r.code,{children:"@Req()"}),", ",(0,t.jsx)(r.code,{children:"@Res()"}),", ",(0,t.jsx)(r.code,{children:"@Headers()"}),", etc.)"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"// No file upload - first param is body\n@Route()\nasync getUserById(id: string) { // \u2705 First param = request body\n  return getUserFromDb(id);\n}\n\n// No file upload - first param is body, subsequent params can use decorators\n@Route()\nasync createUser(\n  { name, email }: { name: string; email: string }, // \u2705 First param = request body\n  @Req() req: Request, // \u2705 Can use decorators for subsequent params\n) {\n  return createUserInDb({ name, email, ip: req.ip });\n}\n\n// With file upload - first param is body, second param is file\n@Route({ file: 'single' })\nasync uploadFile(\n  { description }: { description?: string }, // \u2705 First param = request body\n  file?: Express.Multer.File, // \u2705 Second param = file (when file config is set)\n  @Req() req: Request, // \u2705 Subsequent params can use decorators\n) {\n  return { filename: file?.originalname, description };\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"-nested-routers",children:"\ud83c\udfa8 Nested Routers"}),"\n",(0,t.jsx)(r.p,{children:"Organize your API with nested router structures:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"export const manifest = defineManifest({\n  user: {\n    queries: UserQueriesRouter,    // GET-like operations\n    mutations: UserMutationsRouter, // POST-like operations\n  },\n  files: FilesRouter,\n  admin: {\n    users: AdminUsersRouter,\n    settings: AdminSettingsRouter,\n  },\n});\n"})}),"\n",(0,t.jsx)(r.p,{children:"Routes become:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"POST /nestjs-rpc/user/queries/getUser"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"POST /nestjs-rpc/user/mutations/createUser"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"POST /nestjs-rpc/files/uploadFile"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.code,{children:"POST /nestjs-rpc/admin/users/listAll"})}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"client-pathing",children:"Client Pathing"}),"\n",(0,t.jsx)(r.p,{children:"The nested keys you choose define the access path on the client:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"// Client usage\nconst { data: user } = await rpc.user.queries.getUser({ id: '1' });\nawait rpc.user.mutations.createUser({ name: 'John', email: 'john@example.com' });\nawait rpc.files.uploadFile({ description: 'Avatar' }, { file: myFile });\nconst { data: all } = await rpc.admin.users.listAll();\n"})}),"\n",(0,t.jsx)(r.h2,{id:"-advanced-usage",children:"\ud83d\udd27 Advanced Usage"}),"\n",(0,t.jsx)(r.h3,{id:"dependency-injection",children:"Dependency Injection"}),"\n",(0,t.jsx)(r.p,{children:"Routers are NestJS controllers, so you can use dependency injection:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"@Router()\nexport class UserRouter {\n  constructor(\n    private readonly userService: UserService,\n    private readonly db: DatabaseService,\n  ) {}\n\n  @Route()\n  async getUserById(id: string) {\n    return this.userService.findById(id);\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"custom-parameter-decorators",children:"Custom Parameter Decorators"}),"\n",(0,t.jsx)(r.p,{children:"You can use NestJS parameter decorators for subsequent parameters:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\nimport { Req, Headers, Body } from '@nestjs/common';\nimport type { Request } from 'express';\n\n@Router()\nexport class UserRouter {\n  @Route()\n  updateUser(\n    { id, name }: { id: string; name: string }, // \u2705 First param = input\n    @Req() req: Request, // \u2705 Can use decorators\n    @Headers('x-trace') trace?: string, // \u2705 Can use decorators\n  ) {\n    return { id, name, updatedBy: req.ip, trace };\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:"custom-router-parameter-decorators",children:"Custom Router Parameter Decorators"}),"\n",(0,t.jsxs)(r.p,{children:["Create your own decorators using ",(0,t.jsx)(r.code,{children:"createRouterParamDecorator"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-typescript",children:"import { createRouterParamDecorator } from '@nestjs-rpc/server';\nimport { ExecutionContext } from '@nestjs/common';\n\nconst CurrentUser = createRouterParamDecorator(\n  (data: unknown, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    return request.user; // From your auth middleware\n  }\n);\n\n@Router()\nexport class UserRouter {\n  @Route()\n  async getProfile(\n    {}, // \u2705 First param still reserved for input (can be empty object)\n    @CurrentUser() user: User, // \u2705 Custom decorator\n  ) {\n    return user;\n  }\n}\n"})}),"\n",(0,t.jsx)(r.h2,{id:"-further-reading",children:"\ud83d\udcda Further Reading"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://docs.nestjs.com/controllers",children:"NestJS Controllers"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://docs.nestjs.com/providers",children:"NestJS Providers & DI"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"/docs/server/file-uploads",children:"File Uploads"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"/docs/server/execution-context",children:"Execution Context"})}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,i.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>a});var s=n(6540);const t={},i=s.createContext(t);function o(e){const r=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);