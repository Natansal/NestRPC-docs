"use strict";(self.webpackChunknestjs_rpc_docs=self.webpackChunknestjs_rpc_docs||[]).push([[874],{3777:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>d,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"server/execution-context","title":"Execution Context","description":"How routes execute within NestJS. Understanding the execution flow, dependency injection, and NestJS integration.","source":"@site/docs/server/execution-context.md","sourceDirName":"server","slug":"/server/execution-context","permalink":"/NestRPC-docs/docs/server/execution-context","draft":false,"unlisted":false,"editUrl":"https://github.com/Natansal/NestRPC-docs/blob/main/docs/server/execution-context.md","tags":[],"version":"current","frontMatter":{"title":"Execution Context","description":"How routes execute within NestJS. Understanding the execution flow, dependency injection, and NestJS integration."},"sidebar":"tutorialSidebar","previous":{"title":"File Uploads","permalink":"/NestRPC-docs/docs/server/file-uploads"},"next":{"title":"Nest Integration","permalink":"/NestRPC-docs/docs/server/nest-integration"}}');var s=t(4848),o=t(8453);const i={title:"Execution Context",description:"How routes execute within NestJS. Understanding the execution flow, dependency injection, and NestJS integration."},c="Execution Context",d={},a=[{value:"\ud83c\udfaf How It Works",id:"-how-it-works",level:2},{value:"\ud83d\udd27 Dependency Injection",id:"-dependency-injection",level:2},{value:"\ud83d\udee1\ufe0f Guards, Interceptors, and Pipes",id:"\ufe0f-guards-interceptors-and-pipes",level:2},{value:"\ud83d\udce5 Parameter Injection",id:"-parameter-injection",level:2},{value:"\ud83c\udfa8 Custom Parameter Decorators",id:"-custom-parameter-decorators",level:2},{value:"\ud83d\udd04 Execution Flow",id:"-execution-flow",level:2},{value:"\ud83d\udcda Further Reading",id:"-further-reading",level:2}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"execution-context",children:"Execution Context"})}),"\n",(0,s.jsxs)(r.p,{children:["RPC routes run as standard NestJS controller methods after ",(0,s.jsx)(r.code,{children:"nestRpcInit"})," applies decorators. This means they have full access to NestJS features like dependency injection, guards, interceptors, and pipes."]}),"\n",(0,s.jsx)(r.h2,{id:"-how-it-works",children:"\ud83c\udfaf How It Works"}),"\n",(0,s.jsxs)(r.p,{children:["After ",(0,s.jsx)(r.code,{children:"nestRpcInit()"})," is called, NestRPC applies NestJS decorators (",(0,s.jsx)(r.code,{children:"@Controller()"}),", ",(0,s.jsx)(r.code,{children:"@Post()"}),", etc.) to your router classes. When a request comes in:"]}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"NestJS routes the request to the appropriate controller method"}),"\n",(0,s.jsx)(r.li,{children:"The first parameter (index 0) is automatically injected with the request body from the client"}),"\n",(0,s.jsx)(r.li,{children:"If the route has file upload configuration, the second parameter (index 1) is reserved for the file/files"}),"\n",(0,s.jsxs)(r.li,{children:["Subsequent parameters can use NestJS parameter decorators (",(0,s.jsx)(r.code,{children:"@Req()"}),", ",(0,s.jsx)(r.code,{children:"@Res()"}),", ",(0,s.jsx)(r.code,{children:"@Headers()"}),", etc.)"]}),"\n",(0,s.jsx)(r.li,{children:"Guards, interceptors, and pipes execute in their normal order"}),"\n",(0,s.jsx)(r.li,{children:"The method executes and returns a value"}),"\n",(0,s.jsx)(r.li,{children:"The response is sent back to the client"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"-dependency-injection",children:"\ud83d\udd27 Dependency Injection"}),"\n",(0,s.jsx)(r.p,{children:"Your router classes can use dependency injection like any NestJS provider:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\nimport { Injectable } from '@nestjs/common';\n\n@Injectable()\nclass UsersService {\n  find(id: string) {\n    return { id, name: 'John Doe' };\n  }\n}\n\n@Router()\nexport class UserRouter {\n  constructor(private readonly users: UsersService) {}\n\n  @Route()\n  getUser({ id }: { id: string }) {\n    return this.users.find(id);\n  }\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"\ufe0f-guards-interceptors-and-pipes",children:"\ud83d\udee1\ufe0f Guards, Interceptors, and Pipes"}),"\n",(0,s.jsx)(r.p,{children:"All NestJS features work as usual:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\nimport { UseGuards, UseInterceptors, UsePipes } from '@nestjs/common';\nimport { AuthGuard } from './guards/auth.guard';\nimport { LoggingInterceptor } from './interceptors/logging.interceptor';\nimport { ValidationPipe } from './pipes/validation.pipe';\n\n@Router()\n@UseGuards(AuthGuard) // \u2705 Apply guard to all routes\nexport class UserRouter {\n  @Route()\n  @UseInterceptors(LoggingInterceptor) // \u2705 Apply interceptor to specific route\n  @UsePipes(ValidationPipe) // \u2705 Apply pipe to specific route\n  async createUser(input: CreateUserDto) {\n    return this.userService.create(input);\n  }\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-parameter-injection",children:"\ud83d\udce5 Parameter Injection"}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Parameter Rules:"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"First parameter (index 0)"}),": Reserved for the ",(0,s.jsx)(r.strong,{children:"incoming request body"})," from the client. Do not decorate it. Its type flows to the client automatically."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Second parameter (index 1)"}),": If the route has file upload configuration (",(0,s.jsx)(r.code,{children:"file: 'single'"})," or ",(0,s.jsx)(r.code,{children:"file: 'multiple'"}),"), this parameter is reserved for the file/files (",(0,s.jsx)(r.code,{children:"Express.Multer.File"})," or ",(0,s.jsx)(r.code,{children:"Express.Multer.File[]"}),")."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Subsequent parameters"}),": Can use NestJS parameter decorators (",(0,s.jsx)(r.code,{children:"@Req()"}),", ",(0,s.jsx)(r.code,{children:"@Res()"}),", ",(0,s.jsx)(r.code,{children:"@Headers()"}),", etc.):"]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\nimport { Req, Res, Headers, Body } from '@nestjs/common';\nimport type { Request, Response } from 'express';\n\n@Router()\nexport class UserRouter {\n  @Route()\n  async getUserById(\n    id: string, // \u2705 First param = input (no decorator)\n    @Req() req: Request, // \u2705 Can use decorators\n    @Res() res: Response, // \u2705 Can use decorators\n    @Headers('x-trace') trace?: string, // \u2705 Can use decorators\n  ) {\n    // Access request/response\n    const ip = req.ip;\n    res.setHeader('X-Custom-Header', 'value');\n    \n    return this.userService.findById(id);\n  }\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-custom-parameter-decorators",children:"\ud83c\udfa8 Custom Parameter Decorators"}),"\n",(0,s.jsxs)(r.p,{children:["Create custom decorators using ",(0,s.jsx)(r.code,{children:"createRouterParamDecorator"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-typescript",children:"import { createRouterParamDecorator } from '@nestjs-rpc/server';\nimport { ExecutionContext } from '@nestjs/common';\n\nconst CurrentUser = createRouterParamDecorator(\n  (data: unknown, ctx: ExecutionContext) => {\n    const request = ctx.switchToHttp().getRequest();\n    return request.user; // From your auth middleware\n  }\n);\n\n@Router()\nexport class UserRouter {\n  @Route()\n  async getProfile(\n    {}, // \u2705 First param still reserved\n    @CurrentUser() user: User, // \u2705 Custom decorator\n  ) {\n    return user;\n  }\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-execution-flow",children:"\ud83d\udd04 Execution Flow"}),"\n",(0,s.jsx)(r.p,{children:"Here's the complete execution flow:"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"1. Client sends request\n   \u2193\n2. NestJS routing matches to controller method\n   \u2193\n3. Guards execute (if any)\n   \u2193\n4. Interceptors execute (before)\n   \u2193\n5. Pipes execute (transform/validate)\n   \u2193\n6. Route method executes\n   - First param = input from client\n   - Other params = from decorators\n   \u2193\n7. Interceptors execute (after)\n   \u2193\n8. Response sent to client\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-further-reading",children:"\ud83d\udcda Further Reading"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://docs.nestjs.com/controllers",children:"NestJS Controllers"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://docs.nestjs.com/providers",children:"NestJS Providers"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://docs.nestjs.com/guards",children:"NestJS Guards"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://docs.nestjs.com/interceptors",children:"NestJS Interceptors"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://docs.nestjs.com/pipes",children:"NestJS Pipes"})}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>i,x:()=>c});var n=t(6540);const s={},o=n.createContext(s);function i(e){const r=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function c(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),n.createElement(o.Provider,{value:r},e.children)}}}]);