"use strict";(self.webpackChunknestjs_rpc_docs=self.webpackChunknestjs_rpc_docs||[]).push([[523],{7932:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>l,frontMatter:()=>d,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"query/queries","title":"Query Hooks","description":"Type-safe query hooks for fetching data. Direct hooks and factory pattern for reusable queries.","source":"@site/docs/query/queries.md","sourceDirName":"query","slug":"/query/queries","permalink":"/NestRPC-docs/docs/query/queries","draft":false,"unlisted":false,"editUrl":"https://github.com/Natansal/NestRPC-docs/blob/main/docs/query/queries.md","tags":[],"version":"current","frontMatter":{"title":"Query Hooks","description":"Type-safe query hooks for fetching data. Direct hooks and factory pattern for reusable queries."},"sidebar":"tutorialSidebar","previous":{"title":"React Query Integration Overview","permalink":"/NestRPC-docs/docs/query/overview"},"next":{"title":"Mutation Hooks","permalink":"/NestRPC-docs/docs/query/mutations"}}');var i=r(4848),t=r(8453);const d={title:"Query Hooks",description:"Type-safe query hooks for fetching data. Direct hooks and factory pattern for reusable queries."},a="Query Hooks",o={},c=[{value:"\ud83c\udfaf useRpcQuery",id:"-userpcquery",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"With Optional Body",id:"with-optional-body",level:3},{value:"With Options",id:"with-options",level:3},{value:"Conditional Queries",id:"conditional-queries",level:3},{value:"\ud83c\udfed createRpcQuery",id:"-createrpcquery",level:2},{value:"Basic Usage",id:"basic-usage-1",level:3},{value:"With Required Body",id:"with-required-body",level:3},{value:"Advanced: Additional Query Keys",id:"advanced-additional-query-keys",level:3},{value:"\ud83d\udccb Complete Example",id:"-complete-example",level:2},{value:"\ud83c\udfaf Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcda API Reference",id:"-api-reference",level:2},{value:"useRpcQuery",id:"userpcquery",level:3},{value:"createRpcQuery",id:"createrpcquery",level:3},{value:"Query Options",id:"query-options",level:3},{value:"\ud83d\udd17 Related",id:"-related",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"query-hooks",children:"Query Hooks"})}),"\n",(0,i.jsx)(n.p,{children:"Query hooks are used for fetching data from your RPC endpoints. They provide automatic caching, background refetching, and full type safety."}),"\n",(0,i.jsx)(n.h2,{id:"-userpcquery",children:"\ud83c\udfaf useRpcQuery"}),"\n",(0,i.jsx)(n.p,{children:"Direct hook for one-off RPC queries. Automatically handles query key generation, caching, and type inference."}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { useRpcQuery } from '@nestjs-rpc/query';\nimport { rpc } from './rpc-client';\n\nfunction UserProfile({ userId }: { userId: string }) {\n  const { data, isLoading, error } = useRpcQuery(\n    rpc.user.queries.getUser,\n    { id: userId }, // Request body\n  );\n\n  if (isLoading) return <div>Loading...</div>;\n  if (error) return <div>Error: {error.message}</div>;\n  if (!data) return <div>No user found</div>;\n\n  return <div>{data.name} - {data.email}</div>;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"with-optional-body",children:"With Optional Body"}),"\n",(0,i.jsx)(n.p,{children:"For methods that don't require a body (or have optional body):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function UserList() {\n  const { data: users = [] } = useRpcQuery(\n    rpc.user.queries.listUsers,\n    undefined, // No body needed\n  );\n\n  return (\n    <ul>\n      {users.map(user => <li key={user.id}>{user.name}</li>)}\n    </ul>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"with-options",children:"With Options"}),"\n",(0,i.jsx)(n.p,{children:"Pass React Query options for fine-grained control:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function UserProfile({ userId }: { userId: string }) {\n  const { data } = useRpcQuery(\n    rpc.user.queries.getUser,\n    { id: userId },\n    {\n      staleTime: 5000, // Consider data fresh for 5 seconds\n      enabled: !!userId, // Only run when userId is provided\n      refetchInterval: 30000, // Refetch every 30 seconds\n      onSuccess: (data) => {\n        console.log('User loaded:', data);\n      },\n    },\n  );\n\n  return <div>{data?.name}</div>;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"conditional-queries",children:"Conditional Queries"}),"\n",(0,i.jsxs)(n.p,{children:["Use the ",(0,i.jsx)(n.code,{children:"enabled"})," option to conditionally run queries:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function UserProfile({ userId }: { userId: string | null }) {\n  const { data } = useRpcQuery(\n    rpc.user.queries.getUser,\n    { id: userId! }, // Non-null assertion needed when enabled is false\n    {\n      enabled: !!userId, // Only run when userId is truthy\n    },\n  );\n\n  if (!userId) return <div>No user selected</div>;\n  return <div>{data?.name}</div>;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-createrpcquery",children:"\ud83c\udfed createRpcQuery"}),"\n",(0,i.jsx)(n.p,{children:"Factory function to create reusable query hooks with default options. Perfect for creating domain-specific hooks."}),"\n",(0,i.jsx)(n.h3,{id:"basic-usage-1",children:"Basic Usage"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { createRpcQuery } from '@nestjs-rpc/query';\nimport { rpc } from './rpc-client';\n\n// Create a reusable hook with defaults\nconst useUserList = createRpcQuery(rpc.user.queries.listUsers, {\n  staleTime: 60000, // 1 minute\n  refetchOnWindowFocus: false,\n  placeholderData: [], // Guaranteed non-undefined\n});\n\n// Use it in components\nfunction UserList() {\n  const { data: users = [] } = useUserList(undefined);\n  // ...\n}\n\n// Override options per usage\nfunction AnotherComponent() {\n  const { data: users } = useUserList(undefined, {\n    refetchInterval: 10000, // Override default\n  });\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"with-required-body",children:"With Required Body"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"const useUserById = createRpcQuery(rpc.user.queries.getUser, {\n  staleTime: 30000,\n});\n\nfunction UserProfile({ userId }: { userId: string }) {\n  const { data: user } = useUserById({ id: userId });\n  return <div>{user?.name}</div>;\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"advanced-additional-query-keys",children:"Advanced: Additional Query Keys"}),"\n",(0,i.jsx)(n.p,{children:"Extend query keys for more granular cache control:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'// Using array\nconst { data } = useRpcQuery(\n  rpc.user.queries.getUserById,\n  { id: "123" },\n  {\n    useAdditionalQueryKey: ["admin-view"], // Adds to query key\n  },\n);\n\n// Using function (allows using hooks inside)\nconst { data } = useRpcQuery(\n  rpc.user.queries.getUserById,\n  { id: "123" },\n  {\n    useAdditionalQueryKey: () => {\n      const { userRole } = useAuth(); // Can use hooks!\n      return [userRole];\n    },\n  },\n);\n\n// In factory defaults\nconst useUserById = createRpcQuery(rpc.user.queries.getUserById, {\n  useAdditionalQueryKey: ["default"],\n});\n\n// Instance-level keys are merged with factory defaults\nconst { data } = useUserById(\n  { id: "123" },\n  {\n    useAdditionalQueryKey: ["instance"], // Final key: [\'default\', \'instance\']\n  },\n);\n'})}),"\n",(0,i.jsx)(n.h2,{id:"-complete-example",children:"\ud83d\udccb Complete Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"import { createRpcQuery, useRpcQuery } from '@nestjs-rpc/query';\nimport { rpc } from './rpc-client';\n\n// Create reusable hooks\nconst useUserList = createRpcQuery(rpc.user.queries.listUsers, {\n  staleTime: 30000,\n  refetchOnWindowFocus: false,\n  placeholderData: [],\n});\n\nconst useUserById = createRpcQuery(rpc.user.queries.getUser, {\n  staleTime: 60000,\n});\n\nfunction UserManagement() {\n  const { data: users = [], isLoading } = useUserList(undefined);\n  const [selectedUserId, setSelectedUserId] = useState<string | null>(null);\n\n  // Conditional query\n  const { data: selectedUser } = useUserById(\n    { id: selectedUserId! },\n    {\n      enabled: !!selectedUserId,\n    },\n  );\n\n  return (\n    <div>\n      <h2>Users</h2>\n      {isLoading ? (\n        <div>Loading...</div>\n      ) : (\n        <ul>\n          {users.map(user => (\n            <li key={user.id} onClick={() => setSelectedUserId(user.id)}>\n              {user.name}\n            </li>\n          ))}\n        </ul>\n      )}\n\n      {selectedUser && (\n        <div>\n          <h3>Selected User</h3>\n          <p>Name: {selectedUser.name}</p>\n          <p>Email: {selectedUser.email}</p>\n        </div>\n      )}\n    </div>\n  );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-best-practices",children:"\ud83c\udfaf Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use factory pattern for reusable queries"})," - Create hooks once, use everywhere"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Set appropriate staleTime"})," - Balance freshness with performance"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use placeholderData"})," - Provide default values for better UX"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Conditional queries"})," - Use ",(0,i.jsx)(n.code,{children:"enabled"})," option to prevent unnecessary requests"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Handle loading and error states"})," - Always provide user feedback"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-api-reference",children:"\ud83d\udcda API Reference"}),"\n",(0,i.jsx)(n.h3,{id:"userpcquery",children:"useRpcQuery"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function useRpcQuery<TBody, TRet, TData = TRet>(\n  method: RpcMethod<TBody, TRet> & { [PathSymbol]: string[] },\n  body: TBody,\n  options?: RpcQueryOptions<UseQueryOptions<TRet, AxiosError, TData, QueryKey>>,\n  queryClient?: QueryClient,\n): UseQueryResult<TData, AxiosError>;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"createrpcquery",children:"createRpcQuery"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"function createRpcQuery<TBody, TRet, TData = TRet>(\n  method: RpcMethod<TBody, TRet> & { [PathSymbol]: string[] },\n  defaultOptions?: RpcQueryOptions<UseQueryOptions<TRet, AxiosError, TData>>,\n): RpcQueryHook<TBody, TRet, TData>;\n"})}),"\n",(0,i.jsx)(n.h3,{id:"query-options",children:"Query Options"}),"\n",(0,i.jsx)(n.p,{children:"All standard React Query options are supported, except:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"queryKey"})," - Automatically generated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"queryFn"})," - Automatically generated"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"meta"})," - Automatically generated"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Plus RPC-specific options:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"useAdditionalQueryKey?: unknown[] | (() => unknown[])"})," - Extend query key"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"rpcOptions?: RpcMethodOptions"})," - RPC-specific options"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-related",children:"\ud83d\udd17 Related"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/query/mutations",children:"Mutation Hooks"})," - Mutations with automatic cache invalidation"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/query/advanced",children:"Advanced Features"})," - Additional query keys, file uploads, and more"]}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>a});var s=r(6540);const i={},t=s.createContext(i);function d(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);