"use strict";(self.webpackChunknestjs_rpc_docs=self.webpackChunknestjs_rpc_docs||[]).push([[380],{8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>r});var i=t(6540);const s={},a=i.createContext(s);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(a.Provider,{value:n},e.children)}},9515:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"query/mutations","title":"Mutation Hooks","description":"Type-safe mutation hooks with automatic cache invalidation. Direct hooks and factory pattern for reusable mutations.","source":"@site/docs/query/mutations.md","sourceDirName":"query","slug":"/query/mutations","permalink":"/NestRPC-docs/docs/query/mutations","draft":false,"unlisted":false,"editUrl":"https://github.com/Natansal/NestRPC-docs/blob/main/docs/query/mutations.md","tags":[],"version":"current","frontMatter":{"title":"Mutation Hooks","description":"Type-safe mutation hooks with automatic cache invalidation. Direct hooks and factory pattern for reusable mutations."},"sidebar":"tutorialSidebar","previous":{"title":"Query Hooks","permalink":"/NestRPC-docs/docs/query/queries"},"next":{"title":"Advanced Features","permalink":"/NestRPC-docs/docs/query/advanced"}}');var s=t(4848),a=t(8453);const o={title:"Mutation Hooks",description:"Type-safe mutation hooks with automatic cache invalidation. Direct hooks and factory pattern for reusable mutations."},r="Mutation Hooks",l={},c=[{value:"\ud83c\udfaf useRpcMutation",id:"-userpcmutation",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Automatic Cache Invalidation",id:"automatic-cache-invalidation",level:3},{value:"File Uploads",id:"file-uploads",level:3},{value:"With RPC Options",id:"with-rpc-options",level:3},{value:"\ud83c\udfed createRpcMutation",id:"-createrpcmutation",level:2},{value:"Basic Usage",id:"basic-usage-1",level:3},{value:"Static RPC Options",id:"static-rpc-options",level:3},{value:"Multiple Invalidation Routes",id:"multiple-invalidation-routes",level:3},{value:"\ud83d\udccb Complete Example",id:"-complete-example",level:2},{value:"\ud83c\udfaf Mutation Variables",id:"-mutation-variables",level:2},{value:"Optional Body Types",id:"optional-body-types",level:3},{value:"\ud83c\udfaf Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcda API Reference",id:"-api-reference",level:2},{value:"useRpcMutation",id:"userpcmutation",level:3},{value:"createRpcMutation",id:"createrpcmutation",level:3},{value:"Mutation Options",id:"mutation-options",level:3},{value:"\ud83d\udd17 Related",id:"-related",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"mutation-hooks",children:"Mutation Hooks"})}),"\n",(0,s.jsx)(n.p,{children:"Mutation hooks are used for creating, updating, and deleting data. They support automatic cache invalidation, file uploads, and full type safety."}),"\n",(0,s.jsx)(n.h2,{id:"-userpcmutation",children:"\ud83c\udfaf useRpcMutation"}),"\n",(0,s.jsx)(n.p,{children:"Direct hook for one-off RPC mutations. Supports automatic cache invalidation."}),"\n",(0,s.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { useRpcMutation } from '@nestjs-rpc/query';\nimport { rpc } from './rpc-client';\n\nfunction CreateUser() {\n  const mutation = useRpcMutation(rpc.user.mutations.createUser, {\n    invalidate: [rpc.user.queries.listUsers], // Auto-invalidate after success\n    onSuccess: (data) => {\n      console.log('User created:', data);\n    },\n    onError: (error) => {\n      console.error('Failed to create user:', error);\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    mutation.mutate({\n      body: {\n        name: 'John Doe',\n        email: 'john@example.com',\n      },\n    });\n  };\n\n  return (\n    <form onSubmit={handleSubmit}>\n      <button type=\"submit\" disabled={mutation.isPending}>\n        {mutation.isPending ? 'Creating...' : 'Create User'}\n      </button>\n    </form>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"automatic-cache-invalidation",children:"Automatic Cache Invalidation"}),"\n",(0,s.jsx)(n.p,{children:"Mutations can automatically invalidate related queries:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const mutation = useRpcMutation(rpc.user.mutations.createUser, {\n  invalidate: [\n    rpc.user.queries.listUsers, // Invalidate list\n    rpc.user.queries.getUserById, // Invalidate detail queries\n  ],\n});\n\n// After successful mutation, all queries for these routes are invalidated\n"})}),"\n",(0,s.jsx)(n.h3,{id:"file-uploads",children:"File Uploads"}),"\n",(0,s.jsx)(n.p,{children:"Upload files directly in mutation variables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Single file upload\nconst mutation = useRpcMutation(rpc.files.uploadFile, {\n  onSuccess: () => console.log("Uploaded!"),\n});\n\nmutation.mutate({\n  body: { description: "My file" },\n  file: fileInput.files[0],\n});\n\n// Multiple files\nmutation.mutate({\n  body: { category: "documents" },\n  files: Array.from(fileInput.files),\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"with-rpc-options",children:"With RPC Options"}),"\n",(0,s.jsx)(n.p,{children:"Pass custom RPC options per mutation call:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"mutation.mutate({\n  body: { name: 'John' },\n  rpcOptions: {\n    requestOptions: {\n      headers: { 'X-Custom-Header': 'value' },\n    },\n  },\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-createrpcmutation",children:"\ud83c\udfed createRpcMutation"}),"\n",(0,s.jsx)(n.p,{children:"Factory function to create reusable mutation hooks with default options."}),"\n",(0,s.jsx)(n.h3,{id:"basic-usage-1",children:"Basic Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { createRpcMutation } from '@nestjs-rpc/query';\nimport { rpc } from './rpc-client';\n\n// Create reusable mutation hook\nconst useCreateUser = createRpcMutation(rpc.user.mutations.createUser, {\n  invalidate: [rpc.user.queries.listUsers],\n  onSuccess: () => {\n    console.log('User created successfully');\n  },\n});\n\n// Use in components\nfunction CreateUserForm() {\n  const createUser = useCreateUser({\n    onSuccess: (data) => {\n      // Additional per-component logic\n      navigate(`/users/${data.id}`);\n    },\n  });\n\n  return (\n    <button onClick={() => createUser.mutate({ body: { name: 'John', email: 'john@example.com' } })}>\n      Create\n    </button>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"static-rpc-options",children:"Static RPC Options"}),"\n",(0,s.jsx)(n.p,{children:"Set RPC options that apply to all mutations from the hook:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'const useUploadFile = createRpcMutation(rpc.files.uploadFile, {\n  invalidate: [rpc.files.listFiles],\n  rpcOptions: {\n    requestOptions: { timeout: 30000 },\n  },\n});\n\n// Dynamic options override static ones\nconst uploadFile = useUploadFile();\nuploadFile.mutate({\n  body: { description: "My file" },\n  file: fileInput.files[0],\n  rpcOptions: {\n    requestOptions: { timeout: 60000 }, // Overrides the 30000 from hook\n  },\n});\n'})}),"\n",(0,s.jsx)(n.h3,{id:"multiple-invalidation-routes",children:"Multiple Invalidation Routes"}),"\n",(0,s.jsx)(n.p,{children:"Invalidate multiple query routes:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const useCreateUser = createRpcMutation(rpc.user.mutations.createUser, {\n  invalidate: [\n    rpc.user.queries.listUsers,\n    rpc.user.queries.getUserById,\n    rpc.admin.queries.getAllUsers,\n  ],\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-complete-example",children:"\ud83d\udccb Complete Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { createRpcMutation } from '@nestjs-rpc/query';\nimport { rpc } from './rpc-client';\n\n// Create reusable mutation hooks\nconst useCreateUser = createRpcMutation(rpc.user.mutations.createUser, {\n  invalidate: [rpc.user.queries.listUsers],\n});\n\nconst useUpdateUser = createRpcMutation(rpc.user.mutations.updateUser, {\n  invalidate: [rpc.user.queries.listUsers],\n});\n\nconst useDeleteUser = createRpcMutation(rpc.user.mutations.deleteUser, {\n  invalidate: [rpc.user.queries.listUsers],\n});\n\nconst useUploadFile = createRpcMutation(rpc.files.uploadFile, {\n  invalidate: [rpc.files.listFiles],\n});\n\nfunction UserManagement() {\n  const createUser = useCreateUser({\n    onSuccess: () => {\n      toast.success('User created!');\n    },\n  });\n\n  const updateUser = useUpdateUser();\n  const deleteUser = useDeleteUser();\n  const uploadFile = useUploadFile();\n\n  const handleCreate = () => {\n    createUser.mutate({\n      body: {\n        name: 'John Doe',\n        email: 'john@example.com',\n      },\n    });\n  };\n\n  const handleUpdate = (id: string, name: string) => {\n    updateUser.mutate({\n      body: { id, name },\n    });\n  };\n\n  const handleDelete = (id: string) => {\n    deleteUser.mutate({ body: { id } });\n  };\n\n  const handleUpload = (file: File) => {\n    uploadFile.mutate({\n      body: { description: 'User avatar' },\n      file,\n    });\n  };\n\n  return (\n    <div>\n      <button onClick={handleCreate} disabled={createUser.isPending}>\n        {createUser.isPending ? 'Creating...' : 'Create User'}\n      </button>\n      {/* ... */}\n    </div>\n  );\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-mutation-variables",children:"\ud83c\udfaf Mutation Variables"}),"\n",(0,s.jsxs)(n.p,{children:["Mutations accept ",(0,s.jsx)(n.code,{children:"RpcMutationBody<TBody>"})," which includes:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"body: TBody"})," - The request body (required if TBody is required, optional otherwise)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"file?: File"})," - Single file to upload"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"files?: File[]"})," - Multiple files to upload"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'rpcOptions?: Omit<RpcMethodOptions, "file" | "files">'})," - Per-call RPC options (overrides static options)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"optional-body-types",children:"Optional Body Types"}),"\n",(0,s.jsx)(n.p,{children:"For methods with no body (void, never, or explicitly undefined):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Method signature: @Route() async clearAll(): Promise<void>\n\nconst mutation = useRpcMutation(rpc.files.clearAll);\n\n// Can pass undefined or nothing\nmutation.mutate(); // \u2705\nmutation.mutate(undefined); // \u2705\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-best-practices",children:"\ud83c\udfaf Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use factory pattern for reusable mutations"})," - Create hooks once, use everywhere"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auto-invalidate related queries"})," - Use ",(0,s.jsx)(n.code,{children:"invalidate"})," option to keep cache fresh"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Handle success and error"})," - Provide user feedback with callbacks"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use static RPC options"})," - Set default options in factory for consistency"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Override per call"})," - Use dynamic options when needed"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-api-reference",children:"\ud83d\udcda API Reference"}),"\n",(0,s.jsx)(n.h3,{id:"userpcmutation",children:"useRpcMutation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function useRpcMutation<TBody, TRet, TOnMutateResult = unknown>(\n  method: RpcMethod<TBody, TRet> & { [PathSymbol]: string[] },\n  options?: RpcMutationOptions<TBody, TRet, TOnMutateResult>,\n): UseMutationResult<TRet, AxiosError, RpcMutationBody<TBody>, TOnMutateResult>;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"createrpcmutation",children:"createRpcMutation"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"function createRpcMutation<TBody, TRet, TOnMutateResult = unknown>(\n  method: RpcMethod<TBody, TRet> & { [PathSymbol]: string[] },\n  defaultOptions?: RpcMutationOptions<TBody, TRet, TOnMutateResult>,\n): (\n  options?: RpcMutationOptions<TBody, TRet, TOnMutateResultOverride>,\n) => UseMutationResult<TRet, AxiosError, RpcMutationBody<TBody>, TOnMutateResultOverride>;\n"})}),"\n",(0,s.jsx)(n.h3,{id:"mutation-options",children:"Mutation Options"}),"\n",(0,s.jsx)(n.p,{children:"All standard React Query mutation options are supported, plus:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"invalidate?: { [PathSymbol]: string[] }[]"})," - Routes to invalidate after success"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'rpcOptions?: Omit<RpcMethodOptions, "file" | "files">'})," - Static RPC options applied to all mutations (can be overridden per call)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-related",children:"\ud83d\udd17 Related"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/query/queries",children:"Query Hooks"})," - Fetching data with queries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/query/advanced",children:"Advanced Features"})," - Additional features and patterns"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(u,{...e})}):u(e)}}}]);