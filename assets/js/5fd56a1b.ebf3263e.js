"use strict";(self.webpackChunknestjs_rpc_docs=self.webpackChunknestjs_rpc_docs||[]).push([[577],{2662:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>a});const l=JSON.parse('{"id":"server/file-uploads","title":"File Uploads","description":"Upload single or multiple files with built-in support. No custom middleware needed.","source":"@site/docs/server/file-uploads.md","sourceDirName":"server","slug":"/server/file-uploads","permalink":"/NestRPC-docs/docs/server/file-uploads","draft":false,"unlisted":false,"editUrl":"https://github.com/Natansal/NestRPC-docs/blob/main/docs/server/file-uploads.md","tags":[],"version":"current","frontMatter":{"title":"File Uploads","description":"Upload single or multiple files with built-in support. No custom middleware needed."},"sidebar":"tutorialSidebar","previous":{"title":"Routers and Routes","permalink":"/NestRPC-docs/docs/server/routers-and-routes"},"next":{"title":"Execution Context","permalink":"/NestRPC-docs/docs/server/execution-context"}}');var s=i(4848),t=i(8453);const r={title:"File Uploads",description:"Upload single or multiple files with built-in support. No custom middleware needed."},o="\ud83d\udce4 File Uploads",d={},a=[{value:"\ud83c\udfaf Single File Upload",id:"-single-file-upload",level:2},{value:"\ud83d\udcda Multiple File Upload",id:"-multiple-file-upload",level:2},{value:"\u2699\ufe0f Advanced File Options",id:"\ufe0f-advanced-file-options",level:2},{value:"Configuration Options",id:"configuration-options",level:3},{value:"\ud83d\udcdd Complete Example",id:"-complete-example",level:2},{value:"\ud83d\udd12 File Validation",id:"-file-validation",level:2},{value:"\ud83d\udcbe File Storage",id:"-file-storage",level:2},{value:"In-Memory Storage (Default)",id:"in-memory-storage-default",level:3},{value:"Disk Storage",id:"disk-storage",level:3},{value:"\ud83c\udfaf Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcda Related Documentation",id:"-related-documentation",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"-file-uploads",children:"\ud83d\udce4 File Uploads"})}),"\n",(0,s.jsxs)(n.p,{children:["NestRPC has ",(0,s.jsx)(n.strong,{children:"built-in support"})," for file uploads. No custom middleware needed! Just use the ",(0,s.jsx)(n.code,{children:"file"})," option in the ",(0,s.jsx)(n.code,{children:"@Route()"})," decorator."]}),"\n",(0,s.jsx)(n.h2,{id:"-single-file-upload",children:"\ud83c\udfaf Single File Upload"}),"\n",(0,s.jsxs)(n.p,{children:["Upload a single file with ",(0,s.jsx)(n.code,{children:"@Route({ file: 'single' })"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\n\n@Router()\nexport class FilesRouter {\n  @Route({ file: 'single' })\n  uploadFile(\n    { description }: { description?: string },\n    file?: Express.Multer.File\n  ) {\n    if (!file) {\n      throw new Error('No file provided');\n    }\n\n    return {\n      success: true,\n      filename: file.originalname,\n      size: file.size,\n      mimetype: file.mimetype,\n      description: description || 'No description',\n    };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Method signature:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"First parameter (index 0)"}),": Reserved for the ",(0,s.jsx)(n.strong,{children:"incoming request body"})," (can be empty ",(0,s.jsx)(n.code,{children:"{}"}),"). This is automatically injected."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Second parameter (index 1)"}),": Reserved for the ",(0,s.jsx)(n.strong,{children:"file"})," (",(0,s.jsx)(n.code,{children:"file?: Express.Multer.File"}),") when ",(0,s.jsx)(n.code,{children:"file: 'single'"})," is configured. Optional, but should be checked."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Subsequent parameters"}),": Can use NestJS parameter decorators (",(0,s.jsx)(n.code,{children:"@Req()"}),", ",(0,s.jsx)(n.code,{children:"@Res()"}),", etc.)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-multiple-file-upload",children:"\ud83d\udcda Multiple File Upload"}),"\n",(0,s.jsxs)(n.p,{children:["Upload multiple files with ",(0,s.jsx)(n.code,{children:"@Route({ file: 'multiple' })"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Router()\nexport class FilesRouter {\n  @Route({ file: 'multiple' })\n  uploadFiles(\n    { category }: { category?: string },\n    files?: Express.Multer.File[]\n  ) {\n    if (!files || files.length === 0) {\n      throw new Error('No files provided');\n    }\n\n    return {\n      success: true,\n      files: files.map(f => ({\n        name: f.originalname,\n        size: f.size,\n        type: f.mimetype,\n      })),\n      count: files.length,\n      category: category || 'uncategorized',\n    };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Method signature:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"First parameter (index 0)"}),": Reserved for the ",(0,s.jsx)(n.strong,{children:"incoming request body"})," (can be empty ",(0,s.jsx)(n.code,{children:"{}"}),"). This is automatically injected."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Second parameter (index 1)"}),": Reserved for the ",(0,s.jsx)(n.strong,{children:"files array"})," (",(0,s.jsx)(n.code,{children:"files?: Express.Multer.File[]"}),") when ",(0,s.jsx)(n.code,{children:"file: 'multiple'"})," is configured. Optional, but should be checked."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Subsequent parameters"}),": Can use NestJS parameter decorators (",(0,s.jsx)(n.code,{children:"@Req()"}),", ",(0,s.jsx)(n.code,{children:"@Res()"}),", etc.)"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\ufe0f-advanced-file-options",children:"\u2699\ufe0f Advanced File Options"}),"\n",(0,s.jsx)(n.p,{children:"For more control, use an object configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Route({\n  file: {\n    mode: 'single',\n    options: {\n      limits: { fileSize: 5 * 1024 * 1024 }, // 5MB limit\n      fileFilter: (req, file, cb) => {\n        // Only allow images\n        if (file.mimetype.startsWith('image/')) {\n          cb(null, true);\n        } else {\n          cb(new Error('Only images are allowed'), false);\n        }\n      },\n    },\n  },\n})\nasync uploadWithLimits(\n  { userId }: { userId: string },\n  file?: Express.Multer.File\n) {\n  // Handle file with custom limits\n  return { userId, filename: file?.originalname, size: file?.size };\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Route({\n  file: {\n    mode: 'single' | 'multiple',\n    options?: MulterOptions, // See multer documentation\n    maxCount?: number, // For 'multiple' mode, max number of files\n  },\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Available options:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"limits"})," - File size limits, field limits, etc."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"fileFilter"})," - Custom file filter function"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"storage"})," - Custom storage engine"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"dest"})," - Destination directory (if using disk storage)"]}),"\n",(0,s.jsxs)(n.li,{children:["And all other ",(0,s.jsx)(n.a,{href:"https://github.com/expressjs/multer#api",children:"Multer options"})]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-complete-example",children:"\ud83d\udcdd Complete Example"}),"\n",(0,s.jsx)(n.p,{children:"Here's a complete example with file management:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import { Router, Route } from '@nestjs-rpc/server';\n\ntype FileMetadata = {\n  id: string;\n  name: string;\n  size: number;\n  type: string;\n  uploadedAt: Date;\n  description?: string;\n  category?: string;\n};\n\n@Router()\nexport class FilesRouter {\n  private uploadedFiles: Map<string, FileMetadata> = new Map();\n  private fileIdCounter = 1;\n\n  @Route({ file: 'single' })\n  uploadFile(\n    { description }: { description?: string },\n    file?: Express.Multer.File\n  ) {\n    if (!file) {\n      throw new Error('No file provided');\n    }\n\n    const fileId = String(this.fileIdCounter++);\n    const fileInfo: FileMetadata = {\n      id: fileId,\n      name: file.originalname,\n      size: file.size,\n      type: file.mimetype,\n      description: description || 'No description',\n      uploadedAt: new Date(),\n    };\n\n    this.uploadedFiles.set(fileId, fileInfo);\n\n    return {\n      success: true,\n      file: fileInfo,\n      message: `File \"${file.originalname}\" uploaded successfully`,\n    };\n  }\n\n  @Route({ file: 'multiple' })\n  uploadFiles(\n    { category }: { category?: string },\n    files?: Express.Multer.File[]\n  ) {\n    if (!files || files.length === 0) {\n      throw new Error('No files provided');\n    }\n\n    const uploaded = files.map((file) => {\n      const fileId = String(this.fileIdCounter++);\n      const fileInfo: FileMetadata = {\n        id: fileId,\n        name: file.originalname,\n        size: file.size,\n        type: file.mimetype,\n        category: category || 'uncategorized',\n        uploadedAt: new Date(),\n      };\n      this.uploadedFiles.set(fileId, fileInfo);\n      return fileInfo;\n    });\n\n    return {\n      success: true,\n      files: uploaded,\n      count: uploaded.length,\n      category: category || 'uncategorized',\n      message: `Successfully uploaded ${uploaded.length} file(s)`,\n    };\n  }\n\n  @Route()\n  listFiles() {\n    return Array.from(this.uploadedFiles.values());\n  }\n\n  @Route()\n  getFile({ id }: { id: string }) {\n    const file = this.uploadedFiles.get(id);\n    if (!file) {\n      return null;\n    }\n    return file;\n  }\n\n  @Route()\n  deleteFile({ id }: { id: string }) {\n    return this.uploadedFiles.delete(id);\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-file-validation",children:"\ud83d\udd12 File Validation"}),"\n",(0,s.jsx)(n.p,{children:"Always validate files in your route handlers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Route({ file: 'single' })\nuploadFile(\n  { userId }: { userId: string },\n  file?: Express.Multer.File\n) {\n  if (!file) {\n    throw new BadRequestException('No file provided');\n  }\n\n  // Validate file size\n  const maxSize = 5 * 1024 * 1024; // 5MB\n  if (file.size > maxSize) {\n    throw new BadRequestException('File size exceeds 5MB limit');\n  }\n\n  // Validate file type\n  const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];\n  if (!allowedTypes.includes(file.mimetype)) {\n    throw new BadRequestException('Invalid file type. Only JPEG, PNG, and GIF are allowed');\n  }\n\n  // Process file...\n  return { success: true, filename: file.originalname };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-file-storage",children:"\ud83d\udcbe File Storage"}),"\n",(0,s.jsx)(n.h3,{id:"in-memory-storage-default",children:"In-Memory Storage (Default)"}),"\n",(0,s.jsxs)(n.p,{children:["By default, files are stored in memory. Access them via ",(0,s.jsx)(n.code,{children:"file.buffer"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"@Route({ file: 'single' })\nuploadFile({}, file?: Express.Multer.File) {\n  if (!file) throw new Error('No file');\n  \n  // Access file buffer\n  const buffer = file.buffer;\n  \n  // Save to database, cloud storage, etc.\n  return { success: true };\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"disk-storage",children:"Disk Storage"}),"\n",(0,s.jsx)(n.p,{children:"To save files to disk, configure Multer options:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"import * as multer from 'multer';\nimport * as path from 'path';\n\n@Route({\n  file: {\n    mode: 'single',\n    options: {\n      storage: multer.diskStorage({\n        destination: (req, file, cb) => {\n          cb(null, './uploads');\n        },\n        filename: (req, file, cb) => {\n          const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n          cb(null, file.fieldname + '-' + uniqueSuffix + path.extname(file.originalname));\n        },\n      }),\n    },\n  },\n})\nuploadFile({}, file?: Express.Multer.File) {\n  // File is saved to disk at './uploads'\n  return { success: true, filename: file?.filename };\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"-best-practices",children:"\ud83c\udfaf Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Always validate files"})," - Check size, type, and presence"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use appropriate error handling"})," - Throw NestJS exceptions"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Consider file size limits"})," - Set reasonable limits in options"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sanitize filenames"})," - Prevent path traversal attacks"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Use cloud storage for production"})," - Don't store files on the server filesystem"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"-related-documentation",children:"\ud83d\udcda Related Documentation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/client/file-uploads",children:"Client File Uploads"})," - How to upload files from the client"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/server/routers-and-routes",children:"Routers and Routes"})," - General route configuration"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/server/error-handling",children:"Error Handling"})," - Error handling patterns"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var l=i(6540);const s={},t=l.createContext(s);function r(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);